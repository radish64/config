#!/bin/sh
if [ $TERM = "dumb" ]; then 
    SEND=notify-send;
    PICK="rofi -dmenu -p Disk -l $x";
else 
    SEND=echo;
    PICK=fzf;
fi

devs=$(lsblk -lp | grep -E "/dev/sd[b-z][0-9]|/dev/mmcblk" | grep "part" | grep -v "/media/")
if [ -z "$devs" ]; then 
    $SEND "No removable disks detected!"
    exit 1
fi

x=$(echo "$devs" | wc -l)
disk=$(echo "$devs" | awk '{print $1, $4}' | $PICK | awk '{print $1}')
if [ -z "$disk" ]; then exit 1; fi

if pmount "$disk"; then
    path=$(echo $disk | sed -e s/dev/media/)
    $SEND "$disk mounted at $path";
fi

