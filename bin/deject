#!/bin/ksh
if [ $TERM = "dumb" ]; then 
    SEND=notify-send;
    PICK="rofi -dmenu -p Disk -l $x";
else 
    SEND=echo;
    PICK=fzf;
fi

devs=$(lsblk -lp | grep -E "/dev/sd[b-z][0-9]|/dev/mmcblk" | grep "part" | grep "/media/")
if [ -z "$devs" ]; then 
    $SEND "No removable disks mounted!"
    exit 1
fi

x=$(echo "$devs" | wc -l)
#disk=$(echo "$devs" | awk '{print $1, $4, $7}' | rofi -dmenu -p Disk -l $x | awk '{print $1}')
disk=$(echo "$devs" | awk '{print $1, $4, $7}' | $PICK | awk '{print $1}')
if [ -z "$disk" ]; then exit 1; fi

if pumount "$disk"; then
    $SEND "$disk has been ejected";
fi


